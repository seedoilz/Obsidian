---
aliases: 
date created: 2023-04-17 17:04:00
date modified: 2024-03-20 11:03:85
title: 享元模式
tags: [software-design/pattern]
---

## 定义
享元模式 (Flyweight Pattern)：运用**共享技术**有效地支持大量**细粒度对象**的复用。系统只使用少量的对象，**而这些对象都很相似，状态变化很小**，可以实现对象的多次复用。由于享元模式要求能够共享的对象必须是细粒度对象，因此它又称为**轻量级模式**，它是一种**对象结构型模式**。

## 结构
享元工厂和原型管理器非常相似
1. Flyweight: 抽象享元类
2. ConcreteFlyweight: 具体享元类
3. UnsharedConcreteFlyweight: 非共享具体享元类
4. FlyweightFactory: 享元工厂类
![](https://spricoder.oss-cn-shanghai.aliyuncs.com/2021-Software-System-Design/img/lec09/8.png)

## 分析
### 优点
1. 极大地减少内存中对象的数量，使得系统在内存中只保存一份。
2. 外部状态相对独立，且不会影响内部状态，从而使得享元对象可以在不同环境中被共享。

### 缺点
1. 使得系统更加复杂，需要分离内部状态和外部状态，复杂化程序逻辑。
2. 为共享，享元模式需要将享元对象的状态外部化，而读取外部状态使得运行时间变长。

### 适用场景
1. 系统有大量相同或相似对象，导致大量内存开销
2. 对象的大部分状态都可以外部化，传入对象
3. 需要维护存储享元对象的享元池，比较消耗资源，所以需要在多次重复使用享元对象时才使用。

#### 实例
虽然网络设备可以共享，但是分配给每一个终端计算机的端口 (Port)是不同的，因此多台计算机虽然可以共享同一个网络设备，但必须使用不同的端口。我们可以将端口从网络设备中抽取出来作为外部状态，需要时再进行设置。
![](https://spricoder.oss-cn-shanghai.aliyuncs.com/2021-Software-System-Design/img/lec09/12.png)